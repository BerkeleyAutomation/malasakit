{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% block title %}{% trans 'Quantitative Questions' %}{% endblock %}
{% block main-heading %}{% trans 'Quantitative Questions' %}{% endblock %}

{% block scripts %}
  <script>
    const RATING_ID_PREFIX = 'rating-';

    $(document).ready(function() {
      $('input[type=range], input[type=number]').each(function() {
        if (this.id.startsWith(RATING_ID_PREFIX)) {
          var questionID = this.id.substring(RATING_ID_PREFIX.length);
          var path = ['question-ratings', questionID];
          if (getResponseValue(path) === null) {
            setResponseValue(path, [parseInt($(this).val())]);
          }
          bindHistoryStoreListener($(this), path, parseInt);
        }
      });
      $('button.skip').each(function() {
        $(this).click(function() {
          var sliderID = '#' + RATING_ID_PREFIX + this.id;
          var disabled = $(sliderID).prop('disabled');
          var path = ['question-ratings', this.id];
          var history = getResponseValue(path);
          if (!disabled) {
            history.push(-1);
            $(this).text('Answer Question');
            $(this).css('background-color', '#1dc752');
          } else {
            history.push(history[history.length - 2]);
            $(this).text('Skip Question');
            $(this).css('background-color', 'rgb(63, 169, 228)');
          }
          setResponseValue(path, history);
          $('#' + RATING_ID_PREFIX + this.id).prop('disabled', !disabled);
        });
      });
    });
  </script>
{% endblock %}

{% block content %}
  <ol id="quantitative-questions">
    {% for question in questions %}
      <li>
        <p class="prompt">{% trans question.prompt %}</p>
        {% with id=question.id min_score=question.min_score max_score=question.max_score %}
          {% with left_text=question.left_text right_text=question.right_text %}
            {% include 'questions/rating-slider.html' %}
          {% endwith %}
        {% endwith %}
        <ul class="button-group">
          <label class="switch">
            <input type="checkbox" class="skip" id="{{ question.id }}">
            <div class="slider round"></div>
          </label>
          <p>Skip Question</p>
        </ul>
      </li>
    {% endfor %}
  </ol>
  {% url 'pcari:rate-comments' as next_link %}
  {% include 'nav-buttons.html' %}
{% endblock %}
