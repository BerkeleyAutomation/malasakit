{% extends 'base.html' %}

{% load i18n %}

{% block title %}{% trans 'Peer Responses' %}{% endblock %}
{% block main-heading %}{% trans 'Peer Responses' %}{% endblock %}

{% block scripts %}
  <script>
    const SKIPPED = -1;

    $(document).ready(function() {
      var current = Resource.load('current');
      var ratings = getResponseValue(['question-ratings']);
      current.data = null;
      current.put();
      pushCompletedResponses();
      Resource.delete('selected-comments');

      for (var questionID in ratings) {
        var score = ratings[questionID];
        if (score !== SKIPPED) {
          $('#answer-' + questionID).text(score);
        }
      }
    });
  </script>
{% endblock %}

{% block content %}
  <p>
    {% blocktrans trimmed %}
      Below, you can see how the other respondents answered the quantitative questions.
    {% endblocktrans %}
  </p>
  <div id="peer-responses">
    {% for question in questions %}
      {% if question.active %}
        {% with num_ratings=question.num_ratings mean=question.mean_score|floatformat %}
          {% if num_ratings > 0 %}
            <div class="boxed">
              <p>
                {% blocktrans trimmed %}
                  <strong>{{ num_ratings }}</strong> other people answered this question:
                {% endblocktrans %}
              </p>
              <blockquote>
                {% trans question.prompt %}
              </blockquote>
              <div class="bubbled">
                {% blocktrans trimmed %}
                  Average answer: <strong>{{ mean }}</strong>
                {% endblocktrans %}
              </div>
              <div class="bubbled">
                {% with id=question.id %}
                  {% trans 'Your answer:'%} <strong id="answer-{{ id }}">{% trans 'Skip' %}</strong>
                {% endwith %}
              </div>
            </div>
          {% endif %}
        {% endwith %}
      {% endif %}
    {% endfor %}
  </div>
  {% url 'pcari:end' as next_link %}
  {% include 'nav-buttons.html' %}
{% endblock %}
