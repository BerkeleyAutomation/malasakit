{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% block title %}{% trans 'Rate Comments by Other Users' %}{% endblock %}
{% block main-heading %}{% trans 'Rate Comments by Other Users' %}{% endblock %}

{% block static-assets %}
  {{ block.super }}
  <script src="{% static 'js/d3.v4.min.js' %}"></script>
{% endblock %}

{% block scripts %}
  <script>
    var selectedComments = JSON.parse(localStorage.getItem(SELECTED_COMMENTS_KEY)) || {};

    function startDrag(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function continueDrag(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function endDrag(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    var simulation = d3.forceSimulation()
                       .force('charge', d3.forceManyBody());
                       // .force('collide', d3.forceCollide(15));

    $(document).ready(function() {
      selectComments(selectCommentFromStandardError);

      var nodeData = [{x: 200, y: 200}, {x: 200, y: 200}];

      var bloom = d3.select('#bloom');
      var drag = d3.drag().on('start', startDrag).on('drag', continueDrag).on('end', endDrag);
      var nodes = bloom.append('g').selectAll('circle').data(nodeData).enter()
                       .append('circle').attr('r', 10).call(drag);

      function tick() {
        nodes.attr('cx', function(node) { return node.x; })
             .attr('cy', function(node) { return node.y; });
      }

      simulation.nodes(nodeData).on('tick', tick);
    });
  </script>
{% endblock %}

{% block content %}
  <p>
    {% blocktrans trimmed %}
      <!-- Each -->
    {% endblocktrans %}
  </p>

  <svg id='bloom' width="960" height="600"></svg>

  <div class="nav-button">
    <a href="{% url 'pcari:qualitative-questions' %}?lang={{ language_code }}">Next</a>
  </div>
{% endblock %}
