{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% block static-assets %}
  {{ block.super }}
  <script>
    function getIdentifier() {
      return localStorage.getItem("current");
    }

    function updateRespondentData(key, value) {
      if (value === NaN || value === "") {
        return;
      }
      var identifier = getIdentifier();
      var data = JSON.parse(localStorage.getItem(identifier));
      if (!('respondent-data' in data)) {
        data['respondent-data'] = {}
      }
      if (value === NaN || value === "") {
        delete data['respondent-data']
      }
      data['respondent-data'][key] = value;
      localStorage.setItem(identifier, JSON.stringify(data));
    }

    $(document).ready(function() {
      $('#age').on('input', function() {
        var age = parseInt($('#age').val());
        console.log("Updating age to " + age);
        updateRespondentData('age', age);
      });

      $('#gender').on('input', function() {
        var gender = $('#gender').val();
        console.log("Updating gender to " + gender);
      })
    });
  </script>
{% endblock %}

{% block title %}{% trans 'Personal Information' %}{% endblock %}
{% block main-heading %}{% trans 'Personal Information' %}{% endblock %}

{% block page-summary %}
  {% blocktrans trimmed %}
    All questions on this page are strictly optional.
    Your responses will be anonymous.
  {% endblocktrans %}
{% endblock %}

{% block content %}
  <table>
    <tr>
      <td>{% trans 'Age' %}</td>
      <td><input id="age" type="number" min="1" max="120"></td>
    </tr>
    <tr>
      <td>{% trans 'Gender' %}</td>
      <td>
        <select id="gender">
          <option value="" selected>{% trans 'Select gender' %}</option>
          <option value="M">{% trans 'Male' %}</option>
          <option value="F">{% trans 'Female' %}</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>{% trans 'Province' %}</td>
      <td>
        <select id="province">
          <option selected>{% trans 'Select province' %}</option>
          {% for code, name in province_names %}
            <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </td>
    </tr>
    <tr>
      <td>{% trans 'Barangay' %}</td>
      <td><input id="barangay" type="text-field"></td>
    </tr>
  </table>
  <div id="next" class="nav-button">
    <a href="{% url 'pcari:end' %}">{% trans 'Next' %}</a>
  </div>
{% endblock %}
