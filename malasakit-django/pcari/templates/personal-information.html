{% extends 'base.html' %}

{% load i18n %}
{% load static %}

{% block scripts %}
  <script>
    function locationUpdateCallback(response) {
      var province = $('#province').val().trim();
      var barangay = $('#barangay').val().trim();
      if (province.length === 0 && barangay.length === 0) {
        delete response['respondent-data']['location'];
        console.log('Removed location attribute');
      } else {
        if (province.length === 0) {
          response['respondent-data']['location'] = barangay;
        } else if (barangay.length === 0) {
          response['respondent-data']['location'] = province;
        } else {
          response['respondent-data']['location'] = province + ', ' + barangay;
        }
        console.log('Updated location to "' + response['respondent-data']['location'] + '"');
      }
    }

    $(document).ready(function() {
      $('#age').on('input', function() {
        var age = parseInt($(this).val());
        editCurrentResponse(function(response) {
          if (!isNaN(age)) {
            response['respondent-data']['age'] = age;
            console.log('Updated age to ' + age);
          } else {
            delete response['respondent-data']['age'];
            console.log('Removed age');
          }
        });
      });

      $('#gender').on('input', function() {
        var gender = $(this).val().trim();
        editCurrentResponse(function(response) {
          if (gender) {
            response['respondent-data']['gender'] = gender;
            console.log('Updated gender to ' + gender);
          } else {
            delete response['respondent-data']['gender'];
            console.log('')
          }
        });
      });

      $('#province').on('input', function() {
        editCurrentResponse(locationUpdateCallback);
      });
      $('#barangay').on('input', function() {
        editCurrentResponse(locationUpdateCallback);
      });
    });
  </script>
{% endblock %}

{% block title %}{% trans 'Personal Information' %}{% endblock %}
{% block main-heading %}{% trans 'Personal Information' %}{% endblock %}

{% block content %}
  <p id="privacy-notice">
    {% blocktrans trimmed %}
      All questions on this page are strictly optional.
      Your responses will be anonymous.
    {% endblocktrans %}
  </p>
  <table>
    <tr>
      <td>{% trans 'Age' %}</td>
      <td><input id="age" type="number" min="1" max="120"></td>
    </tr>
    <tr>
      <td>{% trans 'Gender' %}</td>
      <td>
        <select id="gender">
          <option value="" selected>{% trans 'Select gender' %}</option>
          <option value="M">{% trans 'Male' %}</option>
          <option value="F">{% trans 'Female' %}</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>{% trans 'Province' %}</td>
      <td>
        <select id="province">
          <option value="" selected>{% trans 'Select province' %}</option>
          {% for code, name in province_names %}
            <option value="{{ code }}">{{ name }}</option>
          {% endfor %}
        </select>
      </td>
    </tr>
    <tr>
      <td>{% trans 'Barangay' %}</td>
      <td><input id="barangay"></td>
    </tr>
  </table>
  <div id="next" class="nav-button">
    <a href="{% url 'pcari:quantitative-questions' %}">{% trans 'Next' %}</a>
  </div>
{% endblock %}
